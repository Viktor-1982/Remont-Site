# Настройка автокоммита фото в GitHub

## Как это работает

Когда вы загружаете фото через админку на Vercel:
1. Фото отправляется в ваш GitHub репозиторий через GitHub API
2. Создаётся автоматический коммит
3. Фото сохраняются навсегда в Git
4. Локально делаете `git pull` чтобы получить фото

## Пошаговая настройка

### Шаг 1: Создайте GitHub Personal Access Token

1. Перейдите: https://github.com/settings/tokens
2. Нажмите **"Generate new token"** → **"Generate new token (classic)"**
3. Задайте имя токена (например: "Vercel Admin Panel")
4. Выберите срок действия (рекомендуется: "No expiration" или длинный срок)
5. Выберите права:
   - ✅ **`repo`** (полный доступ к репозиторию) - это самое важное!
6. Нажмите **"Generate token"**
7. **Скопируйте токен сразу** (он показывается только один раз!)
   - Формат: `ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

### Шаг 2: Настройте переменные в Vercel

1. Откройте ваш проект на [Vercel](https://vercel.com)
2. Перейдите в **Settings** → **Environment Variables**
3. Добавьте следующие переменные:

#### Обязательные переменные:

```
GITHUB_TOKEN = ghp_ваш-токен-из-шага-1
GITHUB_REPO = username/repair-blog
NEXT_PUBLIC_USE_GIT_AUTO_COMMIT = true
```

Где:
- `GITHUB_TOKEN` — токен из шага 1
- `GITHUB_REPO` — ваш репозиторий в формате `username/repo-name`
  - Пример: если репозиторий `https://github.com/viktor/repair-blog`, то `viktor/repair-blog`
- `NEXT_PUBLIC_USE_GIT_AUTO_COMMIT` — `true` для включения автокоммита

#### Опциональные переменные:

```
GITHUB_BRANCH = main
```

Если у вас ветка не `main`, а `master` или другая — укажите её здесь.

4. После добавления переменных:
   - Выберите **Environment**: Production, Preview, Development (или все три)
   - Нажмите **Save**

### Шаг 3: Перезапустите деплой на Vercel

1. Перейдите в **Deployments**
2. Нажмите на три точки у последнего деплоя
3. Выберите **Redeploy**
4. Или сделайте новый commit и push в Git (Vercel автоматически задеплоит)

### Шаг 4: Проверьте работу

1. Откройте админку на вашем сайте: `https://ваш-сайт.com/admin`
2. Создайте или откройте статью
3. Поставьте курсор в нужное место текста
4. Нажмите **"Вставить фото"**
5. Выберите фото
6. Фото должно загрузиться и появиться в тексте

7. Проверьте GitHub:
   - Откройте ваш репозиторий на GitHub
   - Должен появиться новый коммит с сообщением "Add image: ..."
   - Фото должно быть в папке `public/images/[slug-статьи]/`

### Шаг 5: Получите фото локально

```bash
git pull
```

Фото появятся в папке `public/images/` на вашем компьютере!

## Устранение проблем

### Ошибка "GitHub token and repository not configured"

**Причина**: Не настроены переменные окружения в Vercel

**Решение**:
1. Проверьте, что все переменные добавлены в Vercel
2. Убедитесь, что выбрали правильные Environment (Production/Preview/Development)
3. Перезапустите деплой

### Ошибка "Failed to get branch info"

**Причина**: Неправильное имя ветки или репозитория

**Решение**:
1. Проверьте `GITHUB_REPO` — должен быть формат `username/repo-name`
2. Проверьте `GITHUB_BRANCH` — должна быть существующая ветка (обычно `main` или `master`)
3. Проверьте, что токен имеет права `repo`

### Ошибка "Failed to commit to GitHub"

**Причина**: Токен не имеет нужных прав или истёк

**Решение**:
1. Создайте новый токен с правами `repo`
2. Обновите `GITHUB_TOKEN` в Vercel
3. Перезапустите деплой

### Фото не появляются в репозитории

**Причина**: Автокоммит не включен

**Решение**:
1. Проверьте `NEXT_PUBLIC_USE_GIT_AUTO_COMMIT = true` в Vercel
2. Перезапустите деплой

## Безопасность

⚠️ **Важно**:
- Никогда не коммитьте `GITHUB_TOKEN` в код
- Токен должен быть только в Environment Variables Vercel
- Если токен скомпрометирован, немедленно удалите его и создайте новый
- Используйте токены с минимальными необходимыми правами

## Отключение автокоммита

Если хотите вернуться к обычной загрузке (только локально):

1. В Vercel измените:
   ```
   NEXT_PUBLIC_USE_GIT_AUTO_COMMIT = false
   ```
2. Перезапустите деплой

Теперь фото будут загружаться только локально и не попадут в Git автоматически.



